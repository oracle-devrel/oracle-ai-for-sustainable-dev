<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive AI Hologram With Oracle Database</title>
    <link rel="stylesheet" 
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.0/css/bootstrap.min.css" 
          integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTum6k5d8zV6gBiFeWPGFN9MuhOf23Q9Ifjh" 
          crossorigin="anonymous">
    <style>
        body {
            text-align: center;
            padding: 20px;
            background-color: #f4f4f4;
        }
        #transcription {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            background: white;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
            text-align: left;
        }
        button {
            margin-top: 10px;
        }
        .radio-group {
            margin-top: 15px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>Oracle Databaseã‚’ä½¿ç”¨ã—ãŸã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–AIãƒ›ãƒ­ã‚°ãƒ©ãƒ </h1>
    <p>ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€æ—¥æœ¬èªã§è©±ã—ã¦ãã ã•ã„ã€‚çµ‚äº†ã—ã¦è³ªå•ã‚’é€ä¿¡ã™ã‚‹ã«ã¯ã€Œã‚¹ãƒˆãƒƒãƒ— & é€ä¿¡ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>

    <div class="radio-group">
        <label><input type="radio" name="mode" value=" use chat" checked> Chat</label>
        <label><input type="radio" name="mode" value=" use narrate"> Narrate (NL2SQL / Select AI / Vector RAG)</label>
        <!-- <label><input type="radio" name="mode" value="vectorrag"> Vector RAG</label> -->
    </div>

    <button id="startBtn" class="btn btn-primary">ğŸ¤ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="stopSendBtn" class="btn btn-danger" disabled>ğŸ›‘ğŸ“¤ ã‚¹ãƒˆãƒƒãƒ— & é€ä¿¡</button>
    <button id="clearBtn" class="btn btn-warning">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
    <button id="mirrorMeBtn" class="btn btn-info">ğŸ“¸ ã€ŒãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ã€ã«åˆ‡ã‚Šæ›¿ãˆã‚‹</button>
<br>ãŸã¨ãˆã°ã€ã€Œæœ€ã‚‚å£²ã‚Œã¦ã„ã‚‹ãƒ“ãƒ‡ã‚ªã‚²ãƒ¼ãƒ ã¯ä½•ã§ã™ã‹ï¼Ÿã€
    <div id="transcription"></div>
    <p id="responseMessage"></p>

    <script>
        let recognition;
        let isListening = false;
        let transcriptBuffer = "";

        // Check if browser supports SpeechRecognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = true;  // âœ… Keep listening indefinitely
            recognition.interimResults = true;
            recognition.lang = "ja-JP"; // âœ… Japanese Language Code

            recognition.onstart = () => {
                console.log("ğŸ¤ éŸ³å£°èªè­˜ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ...");
                document.getElementById("startBtn").disabled = true;
                document.getElementById("stopSendBtn").disabled = false;
                transcriptBuffer = "";  // Reset buffer
                isListening = true;
            };

            recognition.onend = () => {
                console.log("ğŸ›‘ éŸ³å£°èªè­˜ãŒçµ‚äº†ã—ã¾ã—ãŸã€‚");
                document.getElementById("startBtn").disabled = false;
                document.getElementById("stopSendBtn").disabled = true;
                isListening = false;
            };

            recognition.onerror = (event) => {
                console.error("âš ï¸ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:", event.error);
            };

            recognition.onresult = (event) => {
                let interimTranscript = "";
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        transcriptBuffer += event.results[i][0].transcript + " ";
                    } else {
                        interimTranscript += event.results[i][0].transcript + " ";
                    }
                }

                document.getElementById("transcription").innerText = transcriptBuffer.trim() + " " + interimTranscript.trim();
                document.getElementById("transcription").scrollTop = document.getElementById("transcription").scrollHeight;
            };
        } else {
            alert("âš ï¸ ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚Google Chromeã‚’ãŠè©¦ã—ãã ã•ã„ã€‚");
        }

        // Start listening
        document.getElementById("startBtn").addEventListener("click", () => {
            if (!isListening) recognition.start();
        });

        // Stop listening and send question
        document.getElementById("stopSendBtn").addEventListener("click", async () => {
            if (isListening) recognition.stop();

            const transcriptionText = transcriptBuffer.trim();
            if (!transcriptionText) {
                alert("âš ï¸ ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ï¼");
                return;
            }

            // Get selected mode
            const selectedMode = document.querySelector('input[name="mode"]:checked').value;
            const modifiedText = `${transcriptionText} use ${selectedMode}`;

            const apiUrl = `https://141.148.204.74:8444/aiholo/play?question=${encodeURIComponent(modifiedText)}`;
            
            try {
                const response = await fetch(apiUrl, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json"
                    }
                });

                if (!response.ok) {
                    throw new Error("âŒ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                }

                const result = await response.text();
                console.log("âœ… ã‚µãƒ¼ãƒãƒ¼å¿œç­”:", result);
                document.getElementById("responseMessage").innerText = `âœ… å¿œç­”: ${result}`;
            } catch (error) {
                console.error(error);
                document.getElementById("responseMessage").innerText = "âŒ ã‚¨ãƒ©ãƒ¼: å¿œç­”ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";
            }
        });

        // Clear transcription
        document.getElementById("clearBtn").addEventListener("click", () => {
            transcriptBuffer = "";
            document.getElementById("transcription").innerText = "";
            document.getElementById("responseMessage").innerText = "";
            console.log("ğŸ—‘ï¸ Transcription cleared.");
        });

        // Switch to Mirror Me
        document.getElementById("mirrorMeBtn").addEventListener("click", async () => {
            const apiUrl = "https://141.148.204.74:8444/aiholo/set?value=mirrorme";
            
            try {
                const response = await fetch(apiUrl, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json"
                    }
                });

                if (!response.ok) {
                    throw new Error("âŒ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                }

                const result = await response.text();
                console.log("âœ… Mirror Me Response:", result);
                document.getElementById("responseMessage").innerText = `âœ… Mirror Mode Activated: ${result}`;
            } catch (error) {
                console.error(error);
                document.getElementById("responseMessage").innerText = "âŒ ã‚¨ãƒ©ãƒ¼: Mirror Mode ã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
            }
        });
    </script>
<div style="text-align: center;">
    <span style="display: inline-block; margin-right: 10px;">
        <img src="../images/aiholoarch.png" alt="AI Holo Architecture" width="300">
    </span>
    <span style="display: inline-block;">
        <img src="../images/oracleconverged23ai.webp" alt="Oracle 23 AI" width="550">
    </span>
</div>

</body>
</html>
